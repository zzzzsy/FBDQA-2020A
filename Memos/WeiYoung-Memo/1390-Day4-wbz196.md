# 第四周学习小结

## 金融基础知识

### 基础概念

* 金融：资金融通(狭义)。研究**跨期**（货币的时间价值，折现率，意味着预期）配置**稀缺资源**（经济学存在的原因，价格，和前者决定资产定价）的一门学科（广义）

* 分类：公司金融（融资，偏财务会计）&资产定价（投资端，偏金融工程），还有宏观金融行为金融、金融科技等

* 1. 基本假设：理性人假说（最大化自己的效用而不考虑他人）

  2. 边界条件：资源的稀缺性（产生竞争）&制度费用（交易成本，法律约束）

     基本假设+边界条件 构成金融学的研究范畴

  3. 基本原理：收益与风险的权衡，边际效用递减

  4. 四大理论支柱：**有效市场假说**（价格已经完全反映所有信息，量化投资是捕捉市场的不有效性发现定价错误某种程度上获得信息优势）

     **均指方差组合**

     **CAPM模型**（单因素模型）

     **期权定价BS公式**

###  金融市场与制度

金融市场

* 金融市场是交易金融资产并确定其价格的一种机制
* 功能：资源配置、风险再分配、宏观经济调节
* 直接融资市场（债券股票）、间接（银行）
* 三大参与者：银行，保险（银保监会监管），券商（证监会）。还有基金信托私募等

金融资产

* 资产：有明确产权的任何物品，包括使用权、收入权和转让权。可分为无形资产、实物资产和金融资产。
* 资产价格：未来现金流的折现值之和
* 特点：标准化、价格实时变动
* 流动性递减，风险递增

交易制度：

* T+1: T天买，T+1才能卖

* 涨跌停：10%，ST（有财务问题的公司） 5%，创业板/科创板20%

* 卖空：只允许做多不许卖空

* 交易成本： 佣金（0.025%）&印花税（0.1%）

* 竞价原则：价格优先时间优先

* 竞价方式：集合竞价 连续竞价

* 上证：沪市主板（600、601、602开头）、科创板（688）

  深证：深市主板（000）、中小板（002）、创业板（300）、新三板（不属于A股）

### 资产定价与投资学

* 不同资产、不同时期的折现率r不一样（对于无风险资产是 无风险利率，股票是预期收益率即资金成本）

资产收益率的影响因素：

* 债券：信用和久期

* 股票收益率 = 无风险收益率+风险溢价

* CAPM单因素模型：$E(R_t) - R_f = \beta \times [E(RM_t)-R_f]\\E(R_t)=\alpha + \beta \times[E(RM_t)]$

* Fama-French三因子模型：加入了size（市值）、value（账面价值/市场价值）（在美国市场非常有效）

* Carhat四因子模型：加入了Momentum

* Fama-French五因子模型：加入了size，value，profit，investment

* $sharp\quad ratio = \frac{E(R-p) - R_f}{\sigma_p}$

  ​                               

### CAPM模型实证分析

$$R_t - Rf_t = \alpha+\beta\cdot (RM_t-Rf_t)+\epsilon_t$$

总风险=股票月度收益率的标准差

系统性风险=回归预测值的标准差

公司风险=残差部分的标准差

$总风险^2=系统性风险^2+公司风险^2$



## 聚宽的使用

* 使用本地数据

  from jqdatasdk import *

  auth('注册手机号'，‘聚宽密码’) (显示auth access代表成功链接)

  pd.set_option('display.max_rows',10）

* 在线平台

  策略研究—策略列表—新建策略

  API文档帮助

## 量化交易策略开发实例

## ![雨课堂](https://qn-st0.yuketang.cn/Fv1CUronEpIvTtOng8mRkb6cr-aA)

* 大部分量化交易是用程序化实现并用程序化交易的方式去做的。把交易逻辑用程序实现出来，交易逻辑需要用程序验证，编辑细节很关键
* ![雨课堂](https://qn-st0.yuketang.cn/Fs0qjHAt1B3zSmLtWWDVUaR8oQ-Z)

### 聚宽

#### 聚宽编程框架

* 启动 initialize（） 初始化，只调用一次
* 开盘前 run_daily(pl_before_market_open,time='before_open')
* 盘中run_daily(pl_trade,time='every_bar')(每一个K线过来时都要被自动调用一次)  处理交易逻辑
* 收盘后 run_daily(pl_after_market_open,time='after_close')

#### 参数设置

K线时间级别*如果选择每天，接口函数只会在今天开盘调用一次，工作在日线级别，如果是分钟，pl_trade每一个一分钟K线的开始都会被调用一次*，还有级别更低的tick

**无论什么样的策略，头寸管理都是重中之重**

### 股票池

* 构造优质股票的集合，等待择时信号购买。股票池和择时构成策略基础。

* 选股条件（比如上证50成分股） 再平衡（上证50是一种股票池，股票池多长时间重新调整成分股） 容量（如 50只）

**国家不鼓励炒小炒差**，从2017年开始小盘股开始转折

*净资产收益率（Return on Equity，简称ROE），又称[股东权益报酬率](https://baike.baidu.com/item/股东权益报酬率/9202024)/净值报酬率/[权益报酬率](https://baike.baidu.com/item/权益报酬率/3460217)/权益利润率/[净资产利润率](https://baike.baidu.com/item/净资产利润率/8528440)，是净利润与[平均股东权益](https://baike.baidu.com/item/平均股东权益/2585458)的百分比，是公司税后利润除以净资产得到的百分比率，该指标反映股东权益的[收益水平](https://baike.baidu.com/item/收益水平/2589849)，用以衡量公司运用[自有资本](https://baike.baidu.com/item/自有资本/10838522)的效率。指标值越高，说明投资带来的收益越高。该指标体现了自有资本获得净收益的能力。一般来说，**负债增加会导致净资产收益率的上升。***

![img](https://xqimg.imedao.com/168b0fca2673eeac3fe64ffe.jpg)

### 聚宽源代码讲解

滑点：为了保证成交可能用稍高于当前市价的价格买入

初始化全局变量都是g.变量名

盘中 先卖把资金腾出来 再去买

### 择时

* 技术指标

​       均线型（MA,EXPMA)

​       趋势型(MACD,SAR,ASI,DMI)

​       摆动型（KDJ,RSI,CCI,WR,BOLL)

​       能量型（OBV,VOL,VR)

​       *选择适合自己的交易逻辑的技术指标*

金叉：短时均线上穿长时均线 

死叉：短时均线下穿长时均线

金叉买入，死叉卖出

rolling函数把相应均线算出来，pl_close.data.rolling(window=PL_BUY_SHORT_MA).mean()

日K线上穿20日均线：日K线（可理解成一日均线）的收盘价序列，上穿20日均线

初始资金设置选择100万（小资金策略对于量化），容易发现交易策略中明显的问题，各种仓位的分配都可能遇到较大的误差
