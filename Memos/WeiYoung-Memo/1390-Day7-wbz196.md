# 第七周学习小结

## 构造更精细的信号系统：

## 以量化的角度重新认识技术指标

### 上次课回顾

* 路演共性问题：

  股票池策略较多，择时很朴素

  大部分策略主要是beta收益（没有对冲的手段，A股牛短熊长，回撤时间过长，量化重风险收益比）

  缺少对其他品种的尝试

  策略的检验不够完备（对交易记录分析不突出，可能其中一部分选股贡献最大）

  到处都是拟合的痕迹（单边其实是好的）

  缺少交易型的策略（不光看长期的alpha，alpha需要一段时间才能显现。瞄准类固收产品：几乎每个月都没有回撤，年化比固收高，是交易型策略，不是靠选股完成的。股票池类型策略即时加上对冲也不能保证不回撤。越成熟的机构风控越严格）

* 股票池+择时赚取的还是alpha+beta，alpha策略无需对证券组合或大盘的趋势判断，而是追求对冲系统风险后的绝对收益，即无论大盘涨跌都能赚钱【典型：做多股票组合（不是按股指权重编制），做空股指期货对冲】

  $r_P = \beta_p\cdot r_B+\alpha_P+\epsilon_P$

* 信息率：反映主动投资能力的指标

  $IR =\alpha/\omega$(主动收益/主动风险)

  信息率意味着主动承担了相对于基准组合的风险敞口，带来了多少超额收益。也可用来衡量投资经理的主动投资能力，低于0.5不好，大于1很好，0.5-1中庸
  
  

### 常见技术指标分类

**信号是由某个指标或某组指标综合合成得到的**

*了解指标背后的物理含义，要结合目标灵活使用，甚至有时把其作为反向指标用，交易是个博弈，技术指标本质上是序列的滤波器*

1. 均线型（具有一定的压力或支撑作用;MA,EXPMA,BBI...）

2. 趋势型(适于趋势类行情,检测趋势的启动延续和可能的转折;MACD,SAR,ASI,DMI...)
3. 摆动型（适于震荡类的行情，检测超买超卖、波动走势的可能转折点；KDJ,RSI,CCI,WR,BOLL...)
4. 能量型(度量涨跌的力度,预示价格位移的可持续性;依据是"量在价先,量价配合";OBV,VOL,VR...)

**再厉害的技术指标也只是在用不同的法器在算卦**

### 从量化的视角看指标

####  程序化代码

* MACD

  DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);(短区间K线收盘价的指数滑动平均减去长区间的;上涨时通常也会往上走，但比真实价格会有个滞后因为滑动平均有窗口检测的时间)(白线)

  DEA:EMA(DIF,MID)(理论上比DIF反应更慢因又做了一次滤波)(黄线)

  金叉：白线上穿黄线

  MACD:(DIF-DEA)*2, COLORSTICK(红绿柱)

* KD-随机指数

  $$\%K=100\times \frac{Close-\min_n Low}{\max_n High-\min_n Low}$$

  $\% D= MA(\%K,N)$

  *很多指标就是先定义一个值，再做这个值的平滑即均线，即有一根快线和一根慢线，快线上穿慢线即金叉，下穿死叉*

  超买超卖

* RSI-相对强弱指数(比KD用还多)

  $RSI=100* \frac{\sum_1^n MAX(Close -LC,0)}{\sum_1^n |Close-LC|}$（LC是上根K线的收盘价）
  
  判断会反转还是继续趋势依自己的世界观

### 技术指标的应用技巧

   ![img](https://qn-st0.yuketang.cn/FuiQVTbB10E97twBlxZX_SYYBK17) 

  价格突破均线

  价格突破/指标突破   （死亡之吻）

* 顶背离/底背离

  背离至少有两个参考点

  bearish divergence：连接两个高点，价格创新高，但反映强弱的指标(RSI)反而下降(后面大概率下跌)

  bullish divergence

* 指标都有延迟，延迟多少取决于用的bar的多少，及时性和准确性是一对矛盾

### 更多的交易决策依据

![img](https://qn-st0.yuketang.cn/FlSu0rvNDTFPWMlAMjQyrMPdvke6)

有时资金面，资金的流向对个股还是有一定参考价值的

**北向资金：聪明钱，通过沪股通深股通可以在香港交易所直接参与A股股票交易**

大多数公开软件统计的资金指标通常是不好使的，是黑箱

所有报表都是可以做出来的

![img](https://qn-st0.yuketang.cn/FpA8xUCdC8Z2D101O_cTL6yDnvZD)

多个技术指标的融合不要都选一种类型的指标

### 编写程序去量化一个趋势型技术指标

* MACD

  编程检测顶底背离(看DIF)效果比金叉死叉均线等略好

  信号闪烁

#### 趋势型技术指标演示

pyecharts==0.5.0

![img](https://qn-st0.yuketang.cn/FpIzfSbiCQr6oSs_Il8_vnHt8jDp)

* 几个重要参数
  * 信号检测级别（MACD做股票建议30或60分钟）
  * 股票池（建议不要一次加太多）
  * 当前时间
  * 输出缓存及缓存bar数量

![img](https://qn-st0.yuketang.cn/Ft1v9UYNfZ7UijhK0lTCeFNBdXE9)

* 指标与价格不对齐
* 哪个才是高点

* 伪背离(给一个背离程度过滤一下，两次的间隔也应给定一范围)
* 处理信号的闪烁最常用方法——对价格的引用尽量不要用当前这根bar的收盘价(因为当前bar还没收盘所以收盘价一直在动)，一般用最高价或最低价
* 边界与异常，检测样本，参数在边界太敏感的话就修改参数或用其他方式让其不太敏感

**要不断回馈改进**

贴水：IF(股指期货)的价格远远低于沪深三百指数的价格。如果长期贴水，alpha策略赚不了钱

**统计一个单一的技术信号的效果一般服从正态分布均指接近于0** 

可以用收益直方图简单检验下选择的技术信号，如果收益直方图都是偏负收益的分布，那怎么交易都很难，正分布可以优化

![img](https://qn-st0.yuketang.cn/FhtpRHJ8SyzDb9V7rYHLX9kWtIrS)

### 进一步认识K线形态组合

知己知彼，了解其他人是怎么被骗的

#### 经典价格形态

![img](https://qn-st0.yuketang.cn/FnoIKY53iUUnB-tFS-DqmmaobzUM)

三角旗型和楔形：波动率不断缩小到极致就可能发大招，等一个突破方向

**主力资金是多种资金的一个合力，代表市场方向性的一种力量**

圆底背后的行为经济学，反复折磨，主力吸散户的筹码

个股小盘股越不可靠，动用的主力资金小得多，如果一定想从经典的价格形态中寻找一些交易机会，建议以大盘股或指数作为标的会更稳妥



#### K线组合形态

![img](https://qn-st0.yuketang.cn/FmXYYPgs8qOKiuKt9tq4HGreQGCa)

可以把坊间的算卦研究透反向去做赚取收益

#### 复合形态

**有时候操盘手会故意画出某种形态诱导散户接盘**

#### 形态的自动识别

* 经典价格形态的自动识别

全市场多周期扫描

自动快速不疲劳

可用于量化策略制定

*单纯的形态主观交易想用往往看运气，但如果量化出来作为一种信号再辅以一些其他的逻辑去做可能是有一定意义的*

识别规则：定义一些关键的转折点，检测到它们再用一些规则去套

  ![img](https://qn-st0.yuketang.cn/FqszWvupZ1LZEucH6z3i8IJqwELT)

![img](https://qn-st0.yuketang.cn/FspnOVR3Xmr1ETpk05IY-ZAT3dpd)

* K线组合形态的识别
* 复合形态的识别

![img](https://qn-st0.yuketang.cn/FikrAzaCGOOnXbGEMQeNQR4lDvny)

**用量化的方式实现这些指标一可以检测这些信号是否有效；二可检测它们在什么边界条件下更有效或失效。这才是量化该做的事**

### 震荡突破和RSRS

* 趋势效率：$Eff = (H-L)/\sum_i(H_i-L_i)$

(每个K线的(最高价-最低价)累加做分母，分子是整个区间最高价和最低价的差）

**把主观的特征用数学模型表达出来，特征提取方便量化**

* resistance support relative strength(RSRS)的启发

  ![img](https://qn-st0.yuketang.cn/FpT8ee0jBXGiIzw8i5FNGJeq8z0A)

上面的beta小于1，下面的大于1
