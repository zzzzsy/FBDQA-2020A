### 第四课

#### 金融基础知识

1. 金融基础概念

- 金融学：**跨期**配置**稀缺资源**

  跨期：货币的时间价值（时间上的决策/预期）

  稀缺性

  结合两者：资产定价

- 公司金融：公司端，财政决策、融资行为、IPO等

  资产定价：投资端，研究投资者的投资行为、资产收益率等

- 金融学假设与概念

  - 基本假设：理性人假说，只考虑自己的利益，最大化自己利益
  - 边界条件：资源的稀缺性与制度费用
  - 概念
    - 选择
    - 机会成本：和选择相关
    - 偏好：风险方面（风险厌恶、风险中性、风险偏好）
    - 效用
    - 信息，存在信息不对称的问题。有效市场假设价格包含所有信息，量化的目的是发现市场的不有效性，利用技术优势获得信息优势
    - 预测
  - 基本原理
    - 收益与风险的权衡（收益越高，一般风险也越高）
    - 边际效用递减（效用函数，一阶导>0，二阶导<0）
  - 四大理论假说
    - 有效市场假说
    - 均值方差组合
    - CAPM模型
    - 期权定价BS公式

2. 金融市场与制度

- 金融市场分类：直接融资市场，间接融资市场（以银行为中介）；一级市场（未上市公司股权），二级市场（上市公司）；（投资标的划分）股票市场、债券市场、衍生品市场

- 金融资产
  - 资产：有明确产权的任何物品，包括使用权、收入权和转让权
  - 资产价格：未来现金流的折现值之和（拥有未来收入的许可权）
  - 金融资产的特点：标准化，价值实时变动
  - 流动性：资产变现的难易程度，成交价格的变动幅度
  - 流动性顺序：现金>债券>基金>股票>房地产
  
- 交易制度
  
  <img src="/Users/grace/Desktop/21061602224901_.pic_hd.jpg" style="zoom:30%;" />
  
  - 9：30之前是集合竞价，正常交易时间是连续竞价

3. 资产定价与投资学

- 资产价格决定
  - 折现现金流模型：$P = \sum_{t=1}^n \frac{E(CF_t)}{(1+r)^t}$
  - 债券：未来现金流，票息+本金
  - 股票：未来现金流主要是股息
  - 不同资产、不同时期的折现率r不一样

- 资产收益率的影响因素

  - 债券收益率的主要影响因素：信用，久期

    长久期有溢价

  - 股票收益率=无风险收益率+风险溢价

  - CAPM单因素模型，$R_{M_t}$

  - FF三因子模型，加入Size、Value

  - Carhat四因子模型，加入Momentum

  - FF五因子模型：加入Size、Value、Profit、Investment

- 投资组合理论

  - Efficient frontier
  - CAL
  - 切点
  - 均值方差理论：找夏普比率大的

4. 估计CAPM模型

- 总风险=股票月度收益率的标准差
   
- 系统性风险=回归预测值的标准差
   
- 公司风险=残差部分的标准差
   
- 关系：$总风险^2 = 系统风险^2+公司风险^2$
   
- 异质性风险
   
系统性风险

区分两种超额收益：$\alpha$（想追求的），$E(R)-R_f$（risk premium）



#### 聚宽平台介绍

股票是非常适合入门的金融产品，聚宽是合适的平台

适合期货的量化实践平台：TB

- 聚宽编程框架

  - 启动
    - `Initialize() `
    - 策略运行，只会被调用一次
  - 开盘前
    - `run_daily(pl_before_market_open,time='before_open')`
    - 准备数据
  - 盘中
    - `run_daily(pl_trade,time='every_bar')`
      - 每一个K线过来时函数要被自动调用一次
      - 
    - 计算择时信号，进行买卖操作。
  - 收盘后
    - `run_daily(pl_after_market_close,time='after_close')`
    - 统计交易情况

- 参数设置

  - 回测时间段
  - 初始资金：一千万
  - K线时间级别
    - 如果设置为每天（工作在日线级别），盘中函数 `pl_trade` 仅在每天开盘时被调用
    - 如果设置为分钟，每分钟都会被调用
    - 设置为tick

- 对于不同的策略类型，需要把关注点放在不同地方

  可供关注的方向：提高胜率、提高赔率、头寸分配、提高或降低交易频率、控制交易成本、增加策略的资金容量

  趋势型策略：更关注赔率

  均值回复性策略：更关注胜率

  但头寸分配都是重点

- 一个例子
  - set_benchmark
  - set_slippage() 滑点，为了保证能成交，需要把价格定的稍微高一点
  - set_order_cost() 交易变量
  - 初始化全局变量 形如 `g.`，则在函数各个位置都能访问，跟全局有关，设置后就不改动了

Indicator：财务指标，在帮助的API文档可以搜到



#### 量化交易开发案例

> Important: 理解海龟策略的仓位控制和加仓

自查表：

<img src="/Users/grace/Desktop/21051602224873_.pic.jpg" style="zoom:33%;" />

自己打造交易系统的时候要考虑诸多细节：比如是否可以买进（涨停时买不进）

- 股票池
  - 三要素
    - 选股条件
    - 再平衡，在什么时长重新调整选股条件
    - 容量：决定需不需要限制
  - 股票池里的股票数量不是越多越好，取决于策略需求，比如对性能、稳定性、资金容量的考虑
  - 一个例子：小市值选股，为了避免炒小炒差，可以加入衡量质量的指标，如ROE
    - 补充，ROE，杜邦分析
    - PE，衡量企业的估值，如范围在10-30，可能指企业没有被高估

- 择时

  - 何时买

  - 何时卖

  - 技术指标

    - 均线型

      - MA等

      - 一个简单策略：

        金叉买入：5日均线上穿30日均线，代表趋势向上插入

        死叉卖出：5日均线下穿30日均线

        <img src="/Users/grace/Desktop/屏幕快照 2020-10-09 下午3.44.40.png" style="zoom:50%;" />

    - 趋势型

      - MACD等

    - 摆动型

    - 能量型

前两条非常重要！！

- 股票池择时策略
  - 股票池+择时——策略基础
  - 构造优质股票的集合，但不一定立刻购买，等待择时信号到来时买入
  - 策略逻辑
    - PPT给了一些关键函数
  - 给了双均线择时策略
- 策略的诊断



### 创建自己的交易策略

- 内容
  - 交易品种：股票，ETF基金，商品期货，股指期货等
  - 交易逻辑：多因子、行为金融学等
  - 平台选择
  - 交易策略：均值回复，趋势跟随或其他
  - 交易头寸管理：可以借鉴海龟交易法，也可自创
  - 交易初始资金设置：100万
  - 其他：交易费用的设置咬合力
- 作业内容
  - 交易观点
  - 趋势的具体描述
  - 策略的回测结果和说明
  - 组员分工和各自完成的内容
  - 其他认为重要需要说明的内容
- 形式
  - pre 5min + Q&A 3min
- 注意：考虑交易成本，所有交易要素都要考虑进来