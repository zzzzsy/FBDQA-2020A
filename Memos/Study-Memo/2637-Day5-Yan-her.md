# week 6
## 股票池设计思路

市值因子

估值因子：PE（TTM）

超跌因子

​	（A股反转因子更有效，美股趋势因子更有效）

ST股票的处理

### 股票池

* 选股条件
  * 剔除总市值排名最小的10%股票
  * 剔除PE小于0或大于100的股票
  * 剔除ST股
  * 取25日跌幅前10%的股票
* 再平衡周期
  * 25个交易日
* 容量
  * 无限制

### 择时信号设计

* 买入：20分钟K线，MA3上穿MA200
  * MA3指20日均线
  * 策略用的人越多有效性越差，平台上无20分钟K线，因此用这个指标效果比较好
* 卖出：20分钟K线，MA3下穿MA200

这个策略某些交易退出太晚，趋势策略入场信号远不如出场信号重要——如何设计止盈利止损线？

### 股票池的优化

因子的特殊处理

* PE -> EP
* PB -> BP

多因子模型的选股框架

* 先将因子分类，没类分配权重
* 类内各因子再次分配权重

单因子评分方法

* 因子值（区间）直接打分
* 因子值排序打分

### 择时信号的优化

* 不同级别的K线
* 不同级别的MA
* 小周期大均线
  * 趋势型策略希望早进入的同时避免假信号
  * 早进入：用时间级别小的K线
  * 避免假信号：用大均线（e.g.MA200）

## 均值回复型策略

### 均值回复原理的简单应用

1. 短期市场反转逻辑
   * 建立股票池：过去3（或1）个月表现最差的N只股票
     * N太小可能扛不住风险，太大可能策略就没意义了
   * 再平衡周期：1个月
   * 头寸管理：所有入选股票均仓，按照市值加权
   * 多空组合：做多表现最差的，做空表现最少的

​		做空要考虑融券成本（一般年化9个点）

2. 长期市场反转逻辑
   * 过去1/3/5年表现最差的N只股票，再平衡周期加长，比如1年，也可做空
   * 仍注意N的选择

### 优化方向

1. 尺度量价
   * 左侧入场要设置风控，根据承受能力继续跌多少认错止损
2. 缺口方式：日内均值回复
   * 选择“缺口型”股票：开盘瞬间，选择所有（前一日最低价 - 今日开盘价）小于一个标准差的股票。标准差定义为90天的日间收盘价的收益率的标准差
   * 缩小范围：只保留当天开盘价仍高于收盘价MA20的股票
     * 大趋势不被破坏（量化一般认为MA20代表大趋势）
   * 在剩余股票中，按当日开盘价与前一日最低价相比得出的收益率由低到高，买入排名前十，不足10只就都买入
   * 收盘之前清算（A股T+1？）
3. 套利模式
   * 两只股票之间——完美替代品
   * 两组股票之间——测定相关性
   * 2种或多种ETF之间
   * ETF与一揽子股票之间
   * 现货与期货之间

## 海龟交易法代码

注意交易指令与触发条件里大跳空时用开盘价替代的那条代码

### 检验策略

定义风险：收益率的标准差

注意标准差的年化中若按日年化应用sqrt(250)，天数用交易日

两个重要指标

* 最大回撤
* 夏普比率



## SQL

